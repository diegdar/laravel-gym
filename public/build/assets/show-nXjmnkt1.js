import{T as u}from"./tabulator_esm-DcdEcX3q.js";const i=document.getElementById("activity-schedule-enrolled-table");if(i&&!i.dataset.tabulatorInit){i.dataset.tabulatorInit="1";const s=i.dataset.endpoint;let r;const l=n=>{const d=n===0?120:44+n*38+8,c=Math.min(420,Math.max(120,d));r.setHeight(c+"px")};r=new u(i,{ajaxURL:s,layout:"fitColumns",height:"120px",placeholder:"Sin usuarios inscritos",responsiveLayout:"collapse",columnDefaults:{hozAlign:"center",headerHozAlign:"center",vertAlign:"middle"},ajaxResponse:(n,a,o)=>{const t=o.data??[];return queueMicrotask(()=>l(t.length)),t},columns:[{title:"ID",field:"id",width:70,sorter:"number"},{title:"Nombre",field:"name",responsive:0},{title:"Email",field:"email",responsive:1},{title:"AsistiÃ³",field:"attended",width:90,hozAlign:"center",formatter:n=>`<input type='checkbox' ${n.getValue()?"checked":""} class='attend-toggle' />`,cellClick:(n,a)=>{const o=!!a.getValue();a.setValue(!o,!0)}}],initialSort:[{column:"name",dir:"asc"}]}),window.__enrolledUsersInterval&&clearInterval(window.__enrolledUsersInterval),window.__enrolledUsersInterval=setInterval(()=>r.replaceData(),6e4);const e=document.getElementById("save-attendance");e&&e.addEventListener("click",async()=>{var o;e.disabled=!0;const n=e.dataset.endpoint,a=r.getData().map(t=>({id:t.id,attended:!!t.attended}));try{if(!(await fetch(n,{method:"PUT",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":((o=document.querySelector('meta[name="csrf-token"]'))==null?void 0:o.getAttribute("content"))||""},body:JSON.stringify({records:a})})).ok)throw new Error("Error guardando");r.replaceData(),e.textContent="Guardado",setTimeout(()=>e.textContent="Guardar asistencia",2e3)}catch(t){console.error(t),e.textContent="Error",setTimeout(()=>e.textContent="Guardar asistencia",2500)}finally{e.disabled=!1}})}
