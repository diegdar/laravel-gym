import{T as d}from"./tabulator_esm-DcdEcX3q.js";const s=e=>document.getElementById(e),p="subscription-percentages-table",v="subscription-monthly-net-table",g="subscription-year-select",h="subscription-ages-table";function b(e){const n=e.getValue()??0,t=Math.max(0,Math.min(100,parseFloat(n))),a=Number.isInteger(t)?t:t.toFixed(2);return`<div class="w-full flex items-center gap-2">
        <div class="flex-1 bg-zinc-200 dark:bg-zinc-700 rounded h-3 overflow-hidden">
            <div class="h-full bg-emerald-500 transition-all duration-500" style="width:${t}%;"></div>
        </div>
        <span class="text-xs font-medium tabular-nums">${a}%</span>
    </div>`}function x(e){if(e.dataset.tabulatorInit)return;e.dataset.tabulatorInit="1";const n=new d(e,{ajaxURL:e.dataset.endpoint,ajaxConfig:"GET",layout:"fitColumns",responsiveLayout:"collapse",placeholder:"Sin datos",height:"120px",columnDefaults:{hozAlign:"center",headerHozAlign:"center",vertAlign:"middle"},columns:[{title:"Cuota",field:"fee_translated",responsive:0},{title:"Usuarios",field:"users",responsive:1},{title:"%",field:"percentage",sorter:"number",widthGrow:2,formatter:b,responsive:2}],ajaxResponse:(t,a,o)=>{const r=s("subscription-percentages-total");return r&&(r.textContent=`Total usuarios activos: ${o.total_active_users}`),o.data},initialSort:[{column:"percentage",dir:"desc"}]});window.__subscriptionPercentagesInterval&&clearInterval(window.__subscriptionPercentagesInterval),window.__subscriptionPercentagesInterval=setInterval(()=>n.replaceData(),6e4)}function _(e,n){if(n.dataset.tabulatorInit)return;n.dataset.tabulatorInit="1";const t=e.dataset.endpoint,a=new d(n,{ajaxURL:t,ajaxParams:{year:e.value},layout:"fitColumns",responsiveLayout:"collapse",placeholder:"Sin datos",height:"380px",columnDefaults:{hozAlign:"center",headerHozAlign:"center"},ajaxResponse:(i,l,u)=>u.data??[],columns:[{title:"Mes",field:"month_name",responsive:0,sorter:(i,l,u,m)=>parseInt(u.getData().month,10)-parseInt(m.getData().month,10)},{title:"Altas",field:"signups",sorter:"number",responsive:1},{title:"Bajas",field:"cancellations",sorter:"number",responsive:2},{title:"Neto",field:"net",sorter:"number",responsive:3,formatter:i=>{const l=i.getValue();return`<span class="font-semibold ${l>0?"text-emerald-600":l<0?"text-red-600":"text-zinc-600"}">${l}</span>`}}]}),o=s("export-monthly-json"),r=s("export-monthly-excel"),c=()=>{const i=e.value;o&&(o.href=`${t}/export/json?year=${i}`),r&&(r.href=`${t}/export/excel?year=${i}`)};c(),e.addEventListener("change",()=>{a.setData(t,{year:e.value}),c()})}function f(){const e=s(p);if(!e)return;x(e);const n=s(g),t=s(v);n&&t&&_(n,t);const a=s(h);a&&!a.dataset.tabulatorInit&&(a.dataset.tabulatorInit="1",new d(a,{ajaxURL:a.dataset.endpoint,layout:"fitColumns",height:"177px",placeholder:"Sin datos",responsiveLayout:"collapse",columnDefaults:{hozAlign:"center",headerHozAlign:"center"},ajaxResponse:(o,r,c)=>c.rows??[],columns:[{title:"Rango Edad",field:"range",responsive:0},{title:"Usuarios",field:"count",sorter:"number",responsive:1},{title:"%",field:"percentage",sorter:"number",widthGrow:2,responsive:2,formatter:b}],initialSort:[{column:"percentage",dir:"desc"}]}))}["DOMContentLoaded","livewire:navigated","flux:navigate"].forEach(e=>window.addEventListener(e,f));window.__subscriptionStatsObserver||(window.__subscriptionStatsObserver=new MutationObserver(()=>{const e=s(p);e&&!e.dataset.tabulatorInit&&f()}),window.__subscriptionStatsObserver.observe(document.body,{childList:!0,subtree:!0}));
