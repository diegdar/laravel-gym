import{T as p}from"./tabulator_esm-DcdEcX3q.js";const s=e=>document.getElementById(e),f="subscription-percentages-table",v="subscription-monthly-net-table",g="subscription-year-select",h="subscription-ages-table";function m(e){const a=e.getValue()??0,t=Math.max(0,Math.min(100,parseFloat(a))),n=Number.isInteger(t)?t:t.toFixed(2);return`<div class="w-full flex items-center gap-2">
        <div class="flex-1 bg-zinc-200 dark:bg-zinc-700 rounded h-3 overflow-hidden">
            <div class="h-full bg-emerald-500 transition-all duration-500" style="width:${t}%;"></div>
        </div>
        <span class="text-xs font-medium tabular-nums">${n}%</span>
    </div>`}function x(e){if(e.dataset.tabulatorInit)return;e.dataset.tabulatorInit="1";const a=new p(e,{ajaxURL:e.dataset.endpoint,ajaxConfig:"GET",layout:"fitColumns",responsiveLayout:"collapse",placeholder:"Sin datos",height:"120px",columnDefaults:{hozAlign:"center",headerHozAlign:"center",vertAlign:"middle"},columns:[{title:"Cuota",field:"fee_translated",responsive:0},{title:"Usuarios",field:"users",responsive:1},{title:"%",field:"percentage",sorter:"number",widthGrow:2,formatter:m,responsive:2}],ajaxResponse:(t,n,o)=>{const r=s("subscription-percentages-total");return r&&(r.textContent=`Total usuarios activos: ${o.total_active_users}`),o.data},initialSort:[{column:"percentage",dir:"desc"}]});window.__subscriptionPercentagesInterval&&clearInterval(window.__subscriptionPercentagesInterval),window.__subscriptionPercentagesInterval=setInterval(()=>a.replaceData(),6e4)}function _(e,a){if(a.dataset.tabulatorInit)return;a.dataset.tabulatorInit="1";const t=e.dataset.endpoint,n=new p(a,{ajaxURL:t,ajaxParams:{year:e.value},layout:"fitColumns",responsiveLayout:"collapse",placeholder:"Sin datos",height:"380px",columnDefaults:{hozAlign:"center",headerHozAlign:"center"},ajaxResponse:(i,l,u)=>u.data??[],columns:[{title:"Mes",field:"month_name",responsive:0,sorter:(i,l,u,b)=>parseInt(u.getData().month,10)-parseInt(b.getData().month,10)},{title:"Altas",field:"signups",sorter:"number",responsive:1},{title:"Bajas",field:"cancellations",sorter:"number",responsive:2},{title:"Neto",field:"net",sorter:"number",responsive:3,formatter:i=>{const l=i.getValue();return`<span class="font-semibold ${l>0?"text-emerald-600":l<0?"text-red-600":"text-zinc-600"}">${l}</span>`}}]}),o=s("export-monthly-json"),r=s("export-monthly-excel"),c=()=>{const i=e.value;o&&(o.href=`${t}/export/json?year=${i}`),r&&(r.href=`${t}/export/excel?year=${i}`)};c(),e.addEventListener("change",()=>{n.setData(t,{year:e.value}),c()})}function d(){const e=s(f);if(!e)return;x(e);const a=s(g),t=s(v);a&&t&&_(a,t);const n=s(h);n&&!n.dataset.tabulatorInit&&(n.dataset.tabulatorInit="1",new p(n,{ajaxURL:n.dataset.endpoint,layout:"fitColumns",height:"177px",placeholder:"Sin datos",responsiveLayout:"collapse",columnDefaults:{hozAlign:"center",headerHozAlign:"center"},ajaxResponse:(o,r,c)=>c.rows??[],columns:[{title:"Rango Edad",field:"range",responsive:0},{title:"Usuarios",field:"count",sorter:"number",responsive:1},{title:"%",field:"percentage",sorter:"number",widthGrow:2,responsive:2,formatter:m}],initialSort:[{column:"percentage",dir:"desc"}]}))}(document.readyState==="interactive"||document.readyState==="complete")&&queueMicrotask(d);["DOMContentLoaded","livewire:navigated","flux:navigate","pageshow"].forEach(e=>window.addEventListener(e,d));setTimeout(d,0);window.__subscriptionStatsObserver||(window.__subscriptionStatsObserver=new MutationObserver(()=>{const e=s(f);e&&!e.dataset.tabulatorInit&&d()}),window.__subscriptionStatsObserver.observe(document.body,{childList:!0,subtree:!0}));
